<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualization</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&family=Roboto:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.22.0/cytoscape.min.js"></script>
</head>

<body>
    <header>
        <h1 class="title">Visualizations</h1>
        <nav>
            <a href="index.html">Home</a>
            <a href="about.html">About</a>
            <a href="biomarkers.html">Biomarkers</a>
            <a href="visualizations.html">Explore</a>
        </nav>
    </header>

    <section style="padding: 20px; background-color: #f9f9f9;">
        <h2 style="color: #002b5b;">Interactive Visualization Section</h2>
        <div id="cy-container" style="width: 100%; height: 600px; border: 1px solid #ccc;"></div>
    </section>

    <footer>
        <p>Â© 2024 Systemic Infection Research. All rights reserved.</p>
        <p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/">
            <a property="dct:title" rel="cc:attributionURL" href="https://github.com/izevel/Group-4-Final-Product">GenesGoneWild</a> by 
            <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="https://github.com/martaaapb">Group4_UM_PRA3006</a> is licensed under 
            <a href="https://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
                CC BY 4.0
                <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" alt="">
                <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" alt="">
            </a>
        </p>
    </footer>  

    <script>
        // Initialize Cytoscape
        const cy = cytoscape({
            container: document.getElementById('cy-container'),
            elements: [], // Initially empty
            style: [
                {
                    selector: 'node',
                    style: {
                        'background-color': '#66ccff',
                        'label': 'data(label)',
                        'text-valign': 'center',
                        'text-halign': 'center'
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': 2,
                        'line-color': '#ccc',
                        'target-arrow-color': '#ccc',
                        'target-arrow-shape': 'triangle'
                    }
                }
            ],
            layout: {
                name: 'cose', // CoSE layout
                animate: true
            }
        });

        // Fetch data from JSON file
        fetch('./query.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok: ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                console.log('Fetched Data:', data);

                // Extract pathway relationships
                const elements = extractPathwayRelationships(data);
                
                // Add nodes and edges to Cytoscape
                cy.add(elements.nodes);
                cy.add(elements.edges);
                cy.layout({ name: 'cose' }).run();
            })
            .catch(error => console.error('Error loading JSON data:', error));

        // Function to extract pathways and relationships
        function extractPathwayRelationships(data) {
    const nodes = [];
    const edges = [];
    const maxConnections = 3; // Limit connections for each protein

    const proteinConnections = {};
    const biologicalProcesses = new Set(); // To track biological processes

    data.forEach(item => {
        // Create nodes for proteins
        const proteinNode = {
            data: {
                id: item.proteinLabel,
                label: item.proteinLabel
            }
        };
        const biologicalProcessNode = {
            data: {
                id: item.biologicalprocessLabel,
                label: item.biologicalprocessLabel
            }
        };

        // Add protein node if it doesn't already exist
        if (!nodes.find(node => node.data.id === proteinNode.data.id)) {
            nodes.push(proteinNode);
        }
        // Track biological processes
        biologicalProcesses.add(item.biologicalprocessLabel);

        // Initialize connection count for the protein
        if (!proteinConnections[item.proteinLabel]) {
            proteinConnections[item.proteinLabel] = [];
        }

        // Add edge only if the protein has fewer than maxConnections
        if (proteinConnections[item.proteinLabel].length < maxConnections) {
            edges.push({
                data: {
                    source: proteinNode.data.id,
                    target: biologicalProcessNode.data.id
                }
            });
            proteinConnections[item.proteinLabel].push(item.biologicalprocessLabel);
        }
    });

    // Filter out biological process nodes that are not connected to any proteins
    const connectedBiologicalProcesses = new Set(edges.map(edge => edge.data.target));
    biologicalProcesses.forEach(process => {
        if (connectedBiologicalProcesses.has(process)) {
            nodes.push({
                data: {
                    id: process,
                    label: process
                }
            });
        }
    });

    return { nodes, edges };
}
    </script>
</body>
</html>


